# NXP Platform Accelerator GPIO Validation

## Overview

This project contains test cases aimed at validating the use of GPIOs with NXP Platform Accelerator

Tests are written as JUnit test cases, thus the main entry point is automatically generated by MicroEJ SDK.

Tests can be launched:

-  as a standard Application by using a local launcher.
-  as a Platform Test Suite by building the module.

## Requirements

-  MicroEJ SDK version ``5.2.8`` (included in MicroEJ SDK dist. ``21.11``).
-  MicroEJ Platform built from a MicroEJ Architecture version ``8.0.0`` or higher.
-  See Platform Test Suites `documentation <../../README.rst>`_.
-  Please update the following properties in ```microej-testsuite-common.properties``` file:
    -  `microej.java.property.com.nxp.api.gpio.testsuite.gpio01.number` (regular working existing gpio on the board)
    -  `microej.java.property.com.nxp.api.gpio.testsuite.unreachableGpio01.number` (non existing gpio pin in an existing bank of the board)
    -  `microej.java.property.com.nxp.api.gpio.testsuite.unreachableGpio02.number` (non existing gpio pin in an non existing bank of the board)

## Usage

### Launcher Mode

In MicroEJ SDK,

-  Select ``Run > Run Configurations...``. A launcher named
   ``java-testsuite-runner-core`` should be available under
   ``MicroEJ Application``.

-  In ``Execution`` tab, select the target MicroEJ Platform.

-  Click on ``Run`` button to compile the MicroEJ Application.

-  For a best result in the Java Round Robin test, disable all the C
   native tasks except the MicroEJ task.

-  Link the BSP project with the MicroEJ Application (``microejapp.o``), 
   the MicroEJ Platform runtime (``microejruntime.a``) and the MicroEJ Platform header files (``*.h``).

-  Once all the tests have passed successfully, MicroEJ GPIO is validated.

-  See below for an output example of a successful validation.

::

  NXP PLATFORM ACCELERATOR
  NXP VEE Port '1.0.0' 'ca0b40f5'
  NXP VEE Heap size: 305896 Bytes
  VM START
  OK: TestReadWrite01
  OK: TestPullUp01
  OK: TestPullDown01
  OK: TestIncorrectWriteLevel01
  OK: TestIncorrectWriteLevel02
  OK: TestIncorrectDirection01
  OK: TestIncorrectDirection02
  OK: TestIncorrectPullConfig01
  OK: TestIncorrectPullConfig02
  OK: TestIncorrectPin01
  OK: TestIncorrectPort01
  PASSED: 11
  VM END (exit code = 0)


### Platform Test Suite Mode

-  In MicroEJ SDK, import the ``java-testsuite-runner-gpio`` project in your workspace.

-  Follow the configuration and execution steps described in Platform Test Suites `documentation <../../README.rst>`.

## Dependencies

*All dependencies are retrieved transitively by MicroEJ Module Manager*.

## Troubleshooting

### The test blocks during the Java round robin test under FreeRTOS

#### Issue:

- The test of ``LLMJVM_IMPL_scheduleRequest`` blocks at the following
  step: ``Starting tasks and wait for 10 seconds...``.

#### Solution:

- Ensure the JVM native C task has a priority lower than the FreeRTOS
  timer task defined in ``FreeRTOSConfig.h`` (``configTIMER_TASK_PRIORITY``).

### Platform Test Suite issues

See Platform Test Suites `documentation <../../README.rst>`.

## Source

N/A

## Restrictions

None.

..
    Copyright 2024 NXP.
    Use of this source code is governed by a BSD-style license that can be found with this software.
